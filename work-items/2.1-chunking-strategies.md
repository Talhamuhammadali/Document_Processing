# Work Item 2.1: Chunking Strategy Experiments

## Overview

**What:** Experiment with different chunking strategies (fixed-size, semantic, document-structure-aware) to understand their impact on RAG retrieval quality.

**Why:** Chunking is one of the most important decisions in RAG systems. Poor chunking leads to poor retrieval, which leads to poor answers. Understanding chunking tradeoffs is essential for building effective RAG systems.

**Deliverable:** 
- Notebook comparing chunking strategies
- Retrieval quality metrics for each approach
- Recommendations for different document types
- Reusable chunking utilities

**Estimated Time:** 3-4 hours

**Prerequisites:** 
- Module 1 complete (documents can be processed and parsed)
- Understanding of document structure from Docling work

---

## Learning Objectives

- Understand fixed-size vs semantic vs structure-aware chunking
- Learn to evaluate chunking quality
- Identify when each strategy works best
- Build reusable chunking components

---

## Sub-Tasks

### Task 2.1.1: Fixed-Size Chunking Implementation
**Time:** 30 minutes  
**Priority:** High

**Goal:** Implement and test basic fixed-size chunking with overlap.

**Implementation Steps:**
1. Create `app/chunking/strategies.py`
2. Implement `FixedSizeChunker`:
   - Chunk by character count or token count
   - Configurable overlap between chunks
   - Preserve sentence boundaries when possible
3. Test on sample documents

**Files to Create:**
- `app/chunking/__init__.py`
- `app/chunking/strategies.py`

**Success Criteria:**
- [ ] Fixed-size chunking working with configurable size
- [ ] Overlap implemented correctly
- [ ] Sentence boundary preservation (optional but recommended)

**Learning Outcome:** Understand simplest chunking approach and its limitations.

---

### Task 2.1.2: Semantic Chunking Implementation
**Time:** 1 hour  
**Priority:** High

**Goal:** Implement semantic chunking that groups related content.

**Implementation Steps:**
1. Extend `app/chunking/strategies.py`
2. Implement `SemanticChunker`:
   - Use embeddings to detect topic shifts
   - Calculate similarity between consecutive sentences
   - Create chunks when similarity drops below threshold
3. Test and tune threshold parameter

**Success Criteria:**
- [ ] Semantic chunking identifies topic boundaries
- [ ] Configurable similarity threshold
- [ ] Tested on documents with clear topic shifts

**Learning Outcome:** Learn embedding-based content segmentation.

---

### Task 2.1.3: Structure-Aware Chunking
**Time:** 1 hour  
**Priority:** High

**Goal:** Implement chunking that respects document structure (sections, paragraphs, tables).

**Implementation Steps:**
1. Extend `app/chunking/strategies.py`
2. Implement `StructureAwareChunker`:
   - Use Docling layout detection output
   - Keep sections/headers together
   - Preserve tables as atomic chunks
   - Respect natural document boundaries
3. Test on structured documents

**Success Criteria:**
- [ ] Chunks respect document structure
- [ ] Headers included with relevant content
- [ ] Tables not split mid-content
- [ ] Works with Docling pipeline output

**Learning Outcome:** Understand importance of preserving document semantics.

---

### Task 2.1.4: Chunking Evaluation Framework
**Time:** 1-1.5 hours  
**Priority:** High

**Goal:** Build evaluation framework to compare chunking strategies.

**Implementation Steps:**
1. Create `experiments/chunking_evaluation.ipynb`
2. Define evaluation metrics:
   - Chunk size distribution
   - Semantic coherence (within-chunk similarity)
   - Boundary quality (between-chunk similarity)
   - Information completeness
3. Create test queries and ground truth
4. Evaluate retrieval quality for each strategy

**Success Criteria:**
- [ ] Can evaluate all chunking strategies
- [ ] Metrics show meaningful differences
- [ ] Visual comparisons (charts/plots)
- [ ] Test queries retrieve relevant chunks

**Learning Outcome:** Learn to evaluate chunking objectively.

---

### Task 2.1.5: Documentation & Recommendations
**Time:** 30 minutes  
**Priority:** Medium

**Goal:** Document findings and create chunking strategy guide.

**Implementation Steps:**
1. Create `docs/chunking-strategies-guide.md`
2. Document:
   - When to use each strategy
   - Tradeoffs and limitations
   - Recommended chunk sizes
   - Best practices
3. Include examples and metrics

**Files to Create:**
- `docs/chunking-strategies-guide.md`

**Success Criteria:**
- [ ] Clear recommendations provided
- [ ] Backed by evaluation metrics
- [ ] Includes code examples

**Learning Outcome:** Communicate technical decisions effectively.

---

## Acceptance Criteria

- ✅ Three chunking strategies implemented
- ✅ Evaluation framework working
- ✅ Retrieval quality compared
- ✅ Documentation with recommendations
- ✅ Can explain when to use each strategy

---

## Related Work Items

- **Previous:** Work Item 1.3 (PDF Handling)
- **Next:** [Work Item 2.2: Embedding Model Evaluation](./2.2-embedding-evaluation.md)
